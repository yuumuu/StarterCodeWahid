window.Router={routes:[],init(r){this.routes=r;window.addEventListener("hashchange",()=>this.handleHashChange());window.addEventListener("load",()=>this.handleHashChange());this.handleHashChange()},async handleHashChange(){let h=window.location.hash.slice(1)||"/";const[p,q]=h.split("?");console.log("[Router] Path:",p);let r=this.routes.find(x=>x.path===p);let params={};if(!r){for(const x of this.routes){if(x.path.includes(":")){const rp="^"+x.path.replace(/:[a-zA-Z0-9_]+/g,"([^/]+)")+"$";const m=p.match(new RegExp(rp));if(m){r=x;const pn=(x.path.match(/:[a-zA-Z0-9_]+/g)||[]).map(y=>y.slice(1));m.slice(1).forEach((v,i)=>{params[pn[i]]=v});break}}}}if(window.Store)window.Store.set("params",params);if(!r)r=this.routes.find(x=>x.path==="/404")||{component:"app/pages/404.html"};if(r.beforeEnter){const ok=await r.beforeEnter();if(!ok)return}if(window.Framework&&window.Framework.cache)delete window.Framework.cache[r.component];console.log("[Router] Render:",r.component);await Framework.render(r.component,"router-view");document.querySelectorAll("[href]").forEach(e=>{if(e.getAttribute("href")==="#"+p)e.classList.add("active-link");else e.classList.remove("active-link")})},navigate(p){window.location.hash=p}};
